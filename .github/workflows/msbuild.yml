name: MSBuild + GitHub Release (Split Artifacts)

on:
  push:
    tags:
      - 'v*'  # v1.0, v2.3.1 ë“± íƒœê·¸ push ì‹œ íŠ¸ë¦¬ê±°ë¨

env:
  SOLUTION_FILE_PATH: VideoTalk.sln
  BUILD_CONFIGURATION: Release
  PLATFORM: x64
  BIN_PATH: bin\x64\Release\

permissions:
  contents: write  # GitHub Release ì—…ë¡œë“œ ê¶Œí•œ

jobs:
  build-and-release:
    runs-on: windows-latest

    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4

    - name: ğŸ›  Setup MSBuild
      uses: microsoft/setup-msbuild@v1.0.2

    - name: ğŸ“¦ Restore NuGet packages
      run: nuget restore "${{ env.SOLUTION_FILE_PATH }}"

    - name: ğŸ— Build solution (x64 Release)
      run: msbuild "${{ env.SOLUTION_FILE_PATH }}" /p:Configuration=${{ env.BUILD_CONFIGURATION }} /p:Platform=${{ env.PLATFORM }}

    - name: ğŸ“‚ Create output folders
      run: |
        mkdir binaries
        mkdir symbols

    - name: ğŸ“ Copy binaries (exe, dll, config)
      shell: cmd
      run: |
        copy /Y "${{ env.BIN_PATH }}*.exe" binaries\ || exit 0
        copy /Y "${{ env.BIN_PATH }}*.dll" binaries\ || exit 0
        copy /Y "${{ env.BIN_PATH }}*.config" binaries\ || exit 0

    - name: ğŸ“ Copy PDB files
      shell: cmd
      run: |
        copy /Y "${{ env.BIN_PATH }}*.pdb" symbols\

    - name: ğŸ“¦ Zip binaries
      run: Compress-Archive -Path "binaries\\*" -DestinationPath release-binaries.zip

    - name: ğŸ“¦ Zip symbols
      run: Compress-Archive -Path "symbols\\*" -DestinationPath release-symbols.zip

    - name: ğŸš€ Upload to GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          release-binaries.zip
          release-symbols.zip
